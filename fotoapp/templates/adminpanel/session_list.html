{% extends "adminpanel/base_adminpanel.html" %}

{% block content %}

<div class="container-fluid p-0">

    <div class="toolbar-container">
        <h2 class="toolbar-title">Twoje Sesje</h2>
        
        <input type="text" id="searchInput" class="search-input" placeholder="Szukaj sesji...">
        
        <a href="{% url 'panel_session_add' %}" class="btn btn-success px-4" style="font-weight: 600;">
            + Dodaj sesjÄ™
        </a>
    </div>

    <div class="sessions-grid" id="sessionsContainer">
        {% for s in sessions %}
        <div class="custom-card-wrapper" data-name="{{ s.name|lower }}">
            
            <div class="custom-card">
                
                <div class="card-img-wrapper">
                    {% if s.cover_photo %}
                        {% if s.cover_photo.watermarked_image %}
                             <img src="{{ s.cover_photo.watermarked_image.url }}" alt="{{ s.name }}">
                        {% else %}
                             <img src="{{ s.cover_photo.image.url }}" alt="{{ s.name }}">
                        {% endif %}
                    {% else %}
                        <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#333; color:#777; flex-direction:column;">
                            <span style="font-size:30px;">ðŸ“·</span>
                            <small>Brak okÅ‚adki</small>
                        </div>
                    {% endif %}
                </div>

                <div class="card-content">
                    <div class="card-title">{{ s.name }}</div>
                    <div class="card-desc">
                        {% if s.description %}{{ s.description }}{% else %}Brak opisu{% endif %}
                    </div>
                </div>

                <div class="card-actions">
                    <a href="{% url 'panel_session_edit' s.id %}" class="btn btn-primary btn-sm">
                        Edytuj
                    </a>
                    
                    <button type="button" class="btn btn-danger btn-sm" 
                            data-bs-toggle="modal" 
                            data-bs-target="#deleteModal" 
                            data-session-id="{{ s.id }}" 
                            data-session-name="{{ s.name }}">
                        UsuÅ„
                    </button>
                </div>

            </div> </div>
        {% empty %}
            <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #888;">
                <h3>Brak sesji</h3>
                <p>Kliknij "Dodaj sesjÄ™", aby zaczÄ…Ä‡.</p>
            </div>
        {% endfor %}
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Potwierdzenie usuniÄ™cia</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
      </div>
      <div class="modal-body">
        Czy na pewno chcesz usunÄ…Ä‡ sesjÄ™ <strong id="modal-session-name"></strong>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
        <a href="#" class="btn btn-danger" id="confirm-delete-btn">UsuÅ„</a>
      </div>
    </div>
  </div>
</div>

<script>
    var deleteModal = document.getElementById('deleteModal')

    document.body.appendChild(deleteModal);

    deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget
        var sessionId = button.getAttribute('data-session-id')
        var sessionName = button.getAttribute('data-session-name')
        var modalTitle = deleteModal.querySelector('#modal-session-name')
        var confirmBtn = deleteModal.querySelector('#confirm-delete-btn')
        
        modalTitle.textContent = sessionName
        
        var urlTemplate = "{% url 'panel_session_delete' 0 %}";
        confirmBtn.href = urlTemplate.replace('/0/', '/' + sessionId + '/');
    })

    document.getElementById('searchInput').addEventListener('keyup', function() {
        let filter = this.value.toLowerCase();
        let wrappers = document.querySelectorAll('.custom-card-wrapper');

        wrappers.forEach(function(wrapper) {
            let name = wrapper.getAttribute('data-name');
            if (name.includes(filter)) {
                wrapper.style.display = "block";
            } else {
                wrapper.style.display = "none";
            }
        });
    });
</script>

{% endblock %}